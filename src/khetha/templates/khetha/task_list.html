{% extends 'khetha/base.html' %}
{% load khetha_tags %}

{% block content %}
    <h1>
        Tasks
        {% if user.is_authenticated and user.is_staff %}
            <a class="mdc-button mdc-button--dense"
               data-mdc-auto-init="MDCRipple"
               style="float: right; margin: 0.25em"
               href="{% url 'admin:khetha_task_changelist' %}">
                Edit in admin â€º
            </a>
        {% endif %}
    </h1>

    <div class="mdc-layout-grid__inner">
        {% for task in task_list %}
            <div class="mdc-layout-grid__cell--span-12">
                <div class="mdc-card">
                    <div class="mdc-card__primary-action"
                         data-mdc-auto-init="MDCRipple"
                         tabindex="0">
                        {% with tasksubmission=task|get_submission:user_key %}
                            <a class="d-block p-1 link-unstyled"
                               href="{% url 'task-detail' slug=task.slug %}">

                                <div class="khetha-task-card__title">
                                    {{ task.title }}
                                </div>

                                <div class="mdc-typography--caption">
                                    {{ task.description|linebreaks }}
                                </div>

                                <div role="progressbar"
                                     class="mdc-linear-progress mdc-linear-progress--closed"
                                     data-mdc-auto-init="MDCLinearProgress"
                                     data-khetha-initial-progress="{{ tasksubmission.progress_factor }}">
                                    <div class="mdc-linear-progress__buffering-dots"></div>
                                    <div class="mdc-linear-progress__buffer"></div>
                                    <div class="mdc-linear-progress__bar mdc-linear-progress__primary-bar">
                                        <span class="mdc-linear-progress__bar-inner"></span>
                                    </div>
                                    <div class="mdc-linear-progress__bar mdc-linear-progress__secondary-bar">
                                        <span class="mdc-linear-progress__bar-inner"></span>
                                    </div>
                                </div>

                            </a>
                        {% endwith %}
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
{% endblock %}
